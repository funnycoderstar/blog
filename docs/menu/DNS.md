## 关键词

-   IP
    -   路由和寻址的区别是什么？
-   TCP/UDP
-   DNS

    -   原理
    -   记录值，A, CNAME
    -   CNAME 记录的作用是

-   CDN
    -   原理
    -   CDN 回源
-   HTTPS

## 术语

-   光纤：是一种透明的导光介质，多束光可以在一个介质中并行传播，不仅信号容量大，重量轻，并行度高而且传播距离远。当然，光纤不能弯曲，因此办公室里用来连接交换机和个人电脑的线路肯定不能是光纤，光线通常都用于主干网络。
-   封包损坏（数据传输过程中被损坏）；
-   丢包（数据发送过程中丢失）；
-   重发（数据被重发，比如中间设备通过 2 个路径传递数据）；
-   乱序（到达目的地时数据和发送数据不一致）

-   延迟（latency）：
    延迟指的是 1 bit 的数据从网络的一个终端传送到另一个终端需要的时间。这个时间包括在发送端准备发送的时间、排队发送的时间、发送数据的时间、数据传输的时间等。
-   吞吐量
    吞吐量指单位时间内可以传输的平均数据量。
-   丢包率
    丢表率指发送出去的封包没有到达目的地的比例。 在最大流速确定的网络中，丢表率会直接影响吞吐量。在最大流速确定的网络中，丢表率会直接影响吞吐量。

这三个条件，通常不能同时满足。如果同时追求延迟、吞吐量、丢包率，那么对网络设备的要求就会非常高。不同的情况要求的情况不一样

1. 游戏，要求低延迟，丢包会影响延迟，一个包丢了要重发
2. 下载文件，要求低丢包率
3. 语音电话，少量丢包还能说听清，大量丢包就麻烦了。
   严格希望不丢包的应用比较少，只有极特殊的网络控制管理场景，才需要在互联网层要求不丢包。

-   寻址：给你一个地址，然后找到这个东西。IPv4 协议的寻址过程是逐级寻址。
    寻址就是如何根据 IP 地址找到设备。IP 协议的寻址过程需要逐级找到网络，最后定位设备。

路由（Routing）

-   Mac 地址：设备间通信的本质其实是设备拥有的网络接口（网卡）间的通信。为了区别每个网络接口，互联网工程任务组（IETF）要求每个设备拥有一个唯一的编号，这个就是 MAC 地址。链路层通过 MAC 地址定位网络接口（网卡）
-   MTU： Maximun Transmission Unit，最大传输单元，意思是链路层网络允许的最大传输数据分组的大小。因此 IP 协议要根据 MTU 拆分封包。
-   MSS（Maximun Segment Size，最大段大小）是 TCP 段，或者称为 TCP 分组（TCP Packet）的最大大小。MSS 是传输层概念，MTU 是链路层概念。
-   ARP：一个中间服务帮助根据 IP 地址找到 MAC 地址——这就是地址解析协议（Address Resolution Protocol，ARP）

## 网络分层

-   应用层：HTTP, DNS
-   网络层：IP，
-   传输层：TCP/UDP

## 局域网

同一个局域网中的设备如何交换消息？
IP 地址不也是唯一的吗？其实不然，一旦设备更换位置，比如你把你的电脑从北京邮寄的广州，那么 IP 地址就变了，而电脑网卡的 MAC 地址不会发生变化。总的来说，IP 地址更像现实生活中的地址，而 MAC 地址更像你的身份证号
在一个局域网中，我们不可以将消息从一个接口（网卡）发送到另一个接口（网卡），而是要通过交换机。为什么是这样呢？因为两个网卡间没有线啊！所以数据交换，必须经过交换机，毕竟线路都是由网卡连接交换机的。
数据的发送方，将自己的 MAC 地址、目的地 MAC 地址，以及数据作为一个分组（Packet），也称作 Frame 或者封包，发送给交换机。交换机再根据目的地 MAC 地址，将数据转发到目的地的网络接口（网卡）。

发送接口不能直接通过 MAC 地址发送数据到接收接口，因为子网 1 的交换机不知道子网 2 的接口。这个时候，发送接口需要通过 IP 协议，将数据发送到路由器，再由路由器转发信息到子网 2 的交换机。这里提一个问题，子网 2 的交换机如何根据 IP 地址找到接收接口呢？答案是通过查询 ARP 表。

内网和外网的通信问题？
解决方案就是网络地址转换技术（Network Address Translation）。NAT 技术转换的是 IP 地址，私有 IP 通过 NAT 转换为公网 IP 发送到服务器。服务器的响应，通过 NAT 转换为私有 IP，返回给客户端。通过这种方式，就解决了内网和外网的通信问题。

## IP

IP 协议目前主要有两个版本 IPv4 和 IPv6。IPv4 就是 IP 协议的第 4 个版本。
IPv4 地址是 4 个 8 位（Octet）排列而成，总共可以编址 43 亿个地址。 比如 103.16.3.1 就是一个合法的 Ipv4 地址。4 组数字用.分开，是为了让人可读，实际上在内存和传输过程中，就是直接用 32 位。

### IP 协议的工作原理

先 IP 协议会进行分片，将上游数据拆成一个个的封包（Datagram），然后为封包增加 IP 头部。封包发送出去后，就开始了寻址过程。寻址就是找到 IP 地址对应的设备。在局域网内，如果找不到设备，就需要路由。路由就是找到数据应该往哪里发送。最后通过层层路由定位到具体的设备。

### 下面这几个地址 127.0.0.1, localhost, 0.0.0.0 有什么不同？

127.0.0.1 是一个环回地址。并不表示“本机”，它属于{127,}集合中的一个，而所有网络号为 127 的地址都被称之为回环地址，所以回环地址!=127.0.0.1，它们是包含关系，即回环地址包含 127.0.0.1。localhost 是个域名，而不是一个 ip 地址，用于指代 this computer 或者 this host，可以用它来获取运行在本机上的网络服务。之所以我们经常把 localhost 与 127.0.0.1 认为是同一个是因为我们使用的大多数电脑上都将 localhost 指向了 127.0.0.1 这个地址。一般把 0.0.0.0 称为“unspecified”，即未指定（即无效的，无意义的）地址。

### 路由和寻址的区别是什么？

寻址（Addressing）就是通过地址找设备。和现实生活中的寻址是一样的，比如根据地址找到一个公寓。在 IPv4 协议中，寻址找到的是一个设备所在的位置。
路由（Routing）本质是路径的选择。就好像知道地址，但是到了每个十字路口，还需要选择具体的路径。
所以，要做路由，就必须能够理解地址，也就是需要借助寻址的能力。要通过寻址找到最终的设备，又要借助路由在每个节点选择数据传输的线路。因此，路由和寻址，是相辅相成的关系。

## DNS

DNS 作用

1. 根据域名找到对应 IP 地址
2. 借助域名和 IP 的映射逻辑，实现负载均衡

### DNS 解析过程

浏览器 -> DNS 解析器 -> DNS 缓存 -> DNS 本地服务器 -> DNS 本地服务器缓存 -> 根域名服务器 -> 顶级域名服务器 -> 权威域名服务器

分级缓存策略，上面的每一级都有缓存，只要同一区域的一个用户请求过上述过程，其他用户再次访问的时候直接使用缓存即可。

### DNS 记录

1. A 记录，对应 IP

```js
; 定义www.example.com的ip地址

www.example.com.     IN     A     139.18.28.5;
```

2. CNAME 记录，域名的别名

```js
; 定义www.example.com的别名
a.example.com.          IN     CNAME   b.example.com.
```

用户在浏览器中输入 a.example.com 时候，通过 DNS 查询会知道 a.example.com 是 b.example.com 的别名，因此需要实际 IP 的时候，会去拿 b.example.com 的 A 记录。

作用：设置域名的别名（将一个域名映射到另一个域名上），域名解析的时候，如果看到 CNAME 记录，就从映射目标开始查询
使用场景：

-   网站迁移到新域名，但旧域名依然保留
-   静态资源放到 CDN 上：拉勾网的静态资源域名 s0.lgstatic.com 被 CNAME 到了 s0.lgstatic.com.wswebpic.com。这说明当用户在请求 s0.lgstatic.com（一个拉勾域名）的资源时，实际请求的 CDN 服务提供商的域名。

3.  AAAA 记录：AAAA 记录则是域名和 IPv6 地址的映射关系。

4.  MX 记录（Mail Exchanger Record）
    MX 记录是邮件记录，用来描述邮件服务器的域名。

    ```js
    IN MX mail.lagou.com
    ```

    这样凡是 @lagou 的邮件都会发送到 mail.lagou.com 中，而 mail.lagou.com 的 IP 地址可以通过查询 mail.lagou.com 的 A 记录和 AAAA 记录获得。

5.

### 总结

-   URL 中的 HOST 部分需要被解析为 IP 地址，于是就有了域名系统（DNS）
-   域名系统是一个分级的分布式系统，整体设计也是一个树状结构
-   顶层的根域名服务器和中间的顶级域名服务器，存储的是目录，最终的 DNS 记录由权威域名服务器提供。
-   DNS 记录并不仅仅只有映射 IP 一种能力，DNS 记录还可以设置网站的别名、邮件服务器、DNS 记录位置等能力。

## CDN

内容分发网络（Content Dilivery Network）

CDN 回源是如何工作的？
CDN 回源就是 CDN 节点到源站请求资源，重新设置缓存。通常服务提供方在使用 CDN 的时候，会在自己的某个域名发布静态资源，然后将这个域名交给 CDN。

向 CDN 请求资源的时候，CDN 的智能 DNS 服务会返回距离最近，或者当前空闲的节点。然后去请求这 CDN 资源节点，如果有缓存且未失效，则直接使用缓存，没有缓存，则当前 CDN 资源节点就会去源站请求资源，请求回来后，返回给用户并缓存。

CDN 回源有 3 种情况，一种是 CDN 节点没有对应资源时主动到源站获取资源；另一种是缓存失效后，CDN 节点到源站获取资源；还有一种情况是在 CDN 管理后台或者使用开放接口主动刷新触发回源。

## 待办

-   画一张图表示 DNS 解析的过程
-   画一张图，表示 CDN ， CDN 回源的过程

## 流媒体技术：直播网站是如何实现的

### 概念

-   流媒体：
    是什么？之前看电影，都是先把电影文件下载下来，即全部下载下来才能看。现在是把数据都抽象成流。传输一部分即可播放一部分。
    怎么实现？设置类似目录的格式，将音视频数据进行切片
